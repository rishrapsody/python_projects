
//AZURE PRIMARY ROUTER(jinja2 template)//


set routing-instances as instance-type virtual-router
  
//** set interface lo0 unit 2222 description lg_ASH_cust_ip #It must be already there in the router
set interface lo0 unit 2222 family inet address 10.96.50.2/32
 
  
//** Tunnel to ATAN
set interfaces gr-1/0/0 unit 2002 description tunga_50-002_ASH_cust
set interfaces gr-1/0/0 unit 2002 tunnel source 10.96.50.2
set interfaces gr-1/0/0 unit 2002 tunnel destination 1.1.1.1
set interfaces gr-1/0/0 unit 2002 tunnel routing-instance destination edge
set interfaces gr-1/0/0 unit 2002 family inet address 169.254.181.2/32
set routing-instances as interface gr-1/0/0.2002
 
set protocols oam gre-tunnel interface gr-1/0/0.2002 keepalive-time 5
set protocols oam gre-tunnel interface gr-1/0/0.2002 hold-time 125
 
//** BGP to ATAN
set routing-instances as routing-options autonomous-system 11179
set routing-instances as protocols bgp group ebgp type external
set routing-instances as protocols bgp group ebgp neighbor 169.254.181.1 multihop ttl 2
set routing-instances as protocols bgp group ebgp neighbor 169.254.181.1 description cust-bgp-atan
set routing-instances as protocols bgp group ebgp neighbor 169.254.181.1 export ps-atan-out
set routing-instances as protocols bgp group ebgp neighbor 169.254.181.1 local-address 169.254.181.2
set routing-instances as protocols bgp group ebgp neighbor 169.254.181.1 peer-as 56278
 
//** set policy-options policy-statement ps-atan-out term 10 then metric 10 # It must be already there in the router
  
set routing-instance as routing-options static route 169.254.181.1/32 next-hop gr-1/0/0.2002
edit routing-instance as routing-options static  
annotate route 169.254.181.1/32 "atan_bgp_peer_ip"



//** Router subinterface configuration

set interfaces xe-0/0/2 unit 3333 description vlan-3333_50-002_cust
set interfaces xe-0/0/2 unit 3333 vlan-id 3333
set interfaces xe-0/0/2 unit 3333 family inet address 4.4.4.4/30
set routing-instances as interface xe-0/0/2.3333
  
//** BGP to CLOUD
set routing-instances as protocols bgp group ebgp type external
set routing-instances as protocols bgp group ebgp neighbor 4.4.4.3 description as_pri
set routing-instances as protocols bgp group ebgp neighbor 4.4.4.3 local-address 4.4.4.4
set routing-instances as protocols bgp group ebgp neighbor 4.4.4.3 peer-as 12076
set routing-instances as protocols bgp group ebgp neighbor 4.4.4.3 export ps-ecx-out


  