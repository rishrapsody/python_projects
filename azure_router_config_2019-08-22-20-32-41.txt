
//AZURE SECONDARY ROUTER(jinja2 template)//


set routing-instances a instance-type virtual-router
  
//** set interface lo0 unit 2222 description lg_ASH_cust_ip #It must be already there in the router
set interface lo0 unit 2222 family inet address 10.96.60.44/32
 
  
//** Tunnel to ATAN
set interfaces gr-1/0/0 unit 2044 description tunga_60-044_ASH_b
set interfaces gr-1/0/0 unit 2044 tunnel source 10.96.60.44
set interfaces gr-1/0/0 unit 2044 tunnel destination 1.1.1.1
set interfaces gr-1/0/0 unit 2044 tunnel routing-instance destination edge
set interfaces gr-1/0/0 unit 2044 family inet address 169.254.181.6/32
set routing-instances a interface gr-1/0/0.2044
 
set protocols oam gre-tunnel interface gr-1/0/0.2044 keepalive-time 5
set protocols oam gre-tunnel interface gr-1/0/0.2044 hold-time 125
 
//** BGP to ATAN
set routing-instances a routing-options autonomous-system 11179
set routing-instances a protocols bgp group ebgp type external
set routing-instances a protocols bgp group ebgp neighbor 169.254.181.5 multihop ttl 2
set routing-instances a protocols bgp group ebgp neighbor 169.254.181.5 description b-bgp-atan
set routing-instances a protocols bgp group ebgp neighbor 169.254.181.5 export ps-atan-out
set routing-instances a protocols bgp group ebgp neighbor 169.254.181.5 local-address 169.254.181.6
set routing-instances a protocols bgp group ebgp neighbor 169.254.181.5 peer-as 56278
 
//** set policy-options policy-statement ps-atan-out term 10 then metric 10 # It must be already there in the router
  
set routing-instance a routing-options static route 169.254.181.5/32 next-hop gr-1/0/0.2044
edit routing-instance a routing-options static  
annotate route 169.254.181.5/32 "atan_bgp_peer_ip"



//** Router subinterface configuration

set interfaces xe-0/0/2 unit 3333 description vlan-3333_60-044_b
set interfaces xe-0/0/2 unit 3333 vlan-id 3333
set interfaces xe-0/0/2 unit 3333 family inet address 4.4.4.4/30
set routing-instances a interface xe-0/0/2.3333
  
//** BGP to CLOUD
set routing-instances a protocols bgp group ebgp type external
set routing-instances a protocols bgp group ebgp neighbor 4.4.4.3 description a_pri
set routing-instances a protocols bgp group ebgp neighbor 4.4.4.3 local-address 4.4.4.4
set routing-instances a protocols bgp group ebgp neighbor 4.4.4.3 peer-as 12076
set routing-instances a protocols bgp group ebgp neighbor 4.4.4.3 export ps-ecx-out
  

  